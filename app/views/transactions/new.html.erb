<div class="bibicoin-header-bg-orange">
	<div id="before-content-area">
		<h1><%=t :header_buy %></h1>
	</div>
	
	<div class ="row">
	
	<% if @transaction.transaction_type_id == 0 %>
		Buying
	<% elsif @transaction.transaction_type_id == 1 %>
		Selling
	<% end %>
	
	
		<%= form_for @transaction, :url => {:action => "confirm"} do |f| %>
		
		<!-- Shared -->
		
			<%= f.label :walletID, "Wallet Address" %>
			<%= f.text_field :walletID %>
			
			<%= f.label :name %>
			<%= f.text_field :name %>
			
			<%= f.label :email, "Email Address" %>
			<%= f.text_field :email %>
			
			<!-- TODO: split this out to year / month / day then merge to form date of birth -->
			<%= f.label :DoB, "Date of Birth" %>
			<%= f.text_field :DoB %>
			
			<!-- Buy -> confirm how they want to handlt the transaction - by BTC to NTD?-->	
			<% if @transaction.transaction_type_id == 0 %>
		
				<%= f.label :TWDAmt, "NTD Amount to Buy" %>
				<%= f.text_field :TWDAmt, :oninput => "updateBTCAmt()", :onkeyup => "calculateTotal()" %>
			
				<%= f.label :BTCAmt, "Bitcoin Amount" %>
				<%= f.text_field :BTCAmt, :readonly => true %>
						
			<!-- Sell -->
			<% elsif @transaction.transaction_type_id == 1 %>
			
				<%= f.label :TWDAmt, "NTD Amount" %>
				<%= f.text_field :TWDAmt, :readonly => true %>
				
				<%= f.label :BTCAmt, "Bitcoin Amount to Sell" %>
				<%= f.text_field :BTCAmt, :oninput => "updateNTDAmt()" %>
				
								
			<% end %>
			
			
			<%= f.label :commAmt, "Commission Amount" %>
			<%= f.text_field :commAmt %>
		
			Total Amount 
			<br />
			<p id = "totalAmt">0</p>
					
		<!-- Shared -->
		
			<%= f.label :bankName, "Bank Name" %>
			<%= f.text_field :bankName %>
			
			<%= f.label :bankAcctNumber, "Bank Account Number" %>
			<%= f.text_field :bankAcctNumber %>
			
			<%= f.hidden_field :transaction_type_id, :value => @transaction.transaction_type_id %>
			<%= f.hidden_field :bibicoinBTCtoTWD, :value => @transaction.bibicoinBTCtoTWD %>		
		
			<%= f.hidden_field :commAmt, :value => @transaction.commAmt %>
		
			
			<%= f.submit "Confirm" %>
			
		<% end %>
		
		
	
	</div>
	
<script type="text/javascript">

<!-- function for buy going from NTD to BTC -->
function updateBTCAmt()
{
	var twdAmt = document.getElementById("transaction_TWDAmt").value;
	var btcToTwd = "<%= @transaction.bibicoinBTCtoTWD %>";
	var btcAmt = twdAmt / btcToTwd;
	document.getElementById("transaction_BTCAmt").value = btcAmt;
}

<!-- function for sale going from BTC to NTD -->
function updateNTDAmt()
{
	var btcAmt = document.getElementById("transaction_BTCAmt").value;
	var btcToTwd = "<%= @transaction.bibicoinBTCtoTWD %>";
	var twdAmt = btcAmt * btcToTwd;
	document.getElementById("transaction_TWDAmt").value = twdAmt;
}
<!-- function to calculate commission and display on the screen -->
function calculateTotal()
{
	var twdAmt = parseFloat(document.getElementById("transaction_TWDAmt").value).toFixed(2);
	var commRate = parseFloat(0).toFixed(2);
	var commAmt = parseFloat(0).toFixed(2);
	var COMM_LIMIT_1 = parseFloat("<%= @COMM_LIMIT_1 %>").toFixed(2);
	var COMM_LIMIT_2 = parseFloat("<%= @COMM_LIMIT_2 %>").toFixed(2);
	
	if (twdAmt < COMM_LIMIT_1)
	{
		commRate = parseFloat(0.01).toFixed(2);
	}
	else if (twdAmt >= COMM_LIMIT_1 && twdAmt < COMM_LIMIT_2)
	{
		commRate = parseFloat(0.02).toFixed(2);
	}
	else if (twdAmt >= COMM_LIMIT_2)
	{
		commRate = parseFloat(0.03).toFixed(2);
	}
	
	 	
	commAmt = parseFloat(twdAmt * commRate).toFixed(2);
	if (commAmt == 'NaN')
	{
		commAmt = parseFloat(0).toFixed(2);
	}
	var totalAmt = parseFloat(twdAmt - commAmt).toFixed(2);
	if (totalAmt == 'NaN')
	{
		totalAmt = 0	;
	}
	document.getElementById("transaction_commAmt").value = commAmt;
	document.getElementById("totalAmt").innerHTML = totalAmt;
}
</script>
	
	
	
	
	
</div>